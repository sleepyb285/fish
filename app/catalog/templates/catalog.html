{% extends "base.html" %}

{% block breadcrumbs %}
<div class="breadcrumb">
    <div class="container">
        <div class="row">
            <div class="col">
                <a href="/">Home</a>/
                Каталог
            </div>
        </div>
    </div>
  </div>
{% endblock %}

{% block content %}
{% load imagekit %}
{% load static %}
  <div class="section">
    <div class="container" >
      <h1>Каталог рыбы Fishking</h1>
      <p style="opacity: 50%;">Найдено {{ count }} товаров
      </p>
      <div class="row" >
        <!-- Кнопки категорий -->
        <div class="col-3">
          <div class="col category-list">
            {% if categories %}
            {% for category in categories %}
            <a href="/catalog/{{category.slug}}">
              <div class="col">
                {{category.name}}
              </div>
            </a>
            {% endfor %}
          {% endif %}
          </div>
        </div>
        <div class="col">
          <div class="row"> 
            <!-- Карточки товаров -->
            {% if fishies %}
                {% for fish in fishies %}
                    <div class="col-4">
                      <div class="inner-container">
                            <div class="card">
                                {% if fish.image %}
                                  <a href="fish/{{ fish.slug }}" >
                                    <img class="img-fluid" src="/{{fish.image}}" class="card-img-top" alt="sample text">
                                  </a>
                                {% else %}
                                  <a href="fish/{{ fish.slug }}" >
                                    <img class="img-fluid" src="{% static 'fish_placeholder.png' %}" class="card-img-top" alt="sample text">
                                  </a>
                                {%  endif %}
                                <div class="card-body">
                                  <p class = "card-category">{{ fish.category }}</p>
                                  <h5 class="card-title">{{ fish.name }}</h5>
                                  {% for attr in attributes %}
                                    {% if attr.rel_fish == fish %}
                                      <p class="attributes">{{attr.rel_attribute}}: {{attr}}</p>
                                    {% endif %}
                                  {% endfor %}
                                  <p class="card-text">Всего за {{ fish.price }} руб.</p>
                                  <a href="fish/{{ fish.slug }}" class="btn btn-primary">Подробнее</a>
                                  <button type="button" class="btn btn-commers" data-bs-toggle="modal" data-bs-target="#Callback">
                                    Получить КП
                                  </button>
                                  
                                </div>
                              </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>There are no fish in the store. Eat meat</p>
            {% endif %}
  </div>        
        </div>
        

      </div>
    </div>
  </div>


  <!-- TODO сайдбар с навигацией -->
  <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Что-то по магазину</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <p><img class="img-fluid" src="{% static 'logo.png' %}"></p>
      <p><a href="/">Вернуться на главную</a></p>
      <p><a href="{% url 'catalog' %}">Каталог</a></p>
      <p>Категории:</p>
      <ul>
      {% if categories %}
        {% for category in categories %}
          <li><a href="/catalog/{{category.slug}}">{{category.name}}</a></li>
          {% for sub in subcategories %}
          <ul>
            {% if sub.parent == category %}
              <li><a href="/catalog/{{sub.slug}}">{{sub.name}}</a></li>
            {% endif %}
          </ul>
          {% endfor %}
        {% endfor %}
      {% endif %}
      </ul>
      <p>Поставщики:</p>
      <ul>
        {% if providers %}
          {% for provider in providers %}
            <li><a href="/provider/{{provider.slug}}">{{provider.name}}</a></li>
          {% endfor %}
        {% endif %}
        </ul>
      <p><a href="#">Акции</a></p>
      <p><a href="{% url 'feedback' %}">Оставить отзыв</a></p>
      
    </div>
      </div>
{% endblock %}


{% block pagination %}
<div class="pagination">
  <span class="step-links">
      {% if fishies.has_previous %}
          <a href="?page=1">&laquo; В начало</a>
          <a href="?page={{ fishies.previous_page_number }}">Назад</a>
      {% endif %}

      <span class="current">
          Страница {{ fishies.number }} из {{ fishies.paginator.num_pages }}.
      </span>

      {% if fishies.has_next %}
          <a href="?page={{ fishies.next_page_number }}">Дальше</a>
          <a href="?page={{ fishies.paginator.num_pages }}">В конец &raquo;</a>
      {% endif %}
  </span>
</div>


<div class="modal fade" id="Callback" tabindex="-1" aria-labelledby="CallbackLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="CallbackLabel">Получить КП</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post">
          {% csrf_token %}
          {% for field in form.visible_fields %}
          <div class="input-container">
              <div class="col">
              <div class="col">{{ field.label_tag }}</div>
              {% if field.errors %}
              <div class="col">
                  {{ field.errors }}
              </div>
              {% endif %}
              <div class="col">
              {{ field }}
              </div>
              </div>
          </div>

          {% endfor %}
          <div class="col" style="opacity: 50%">*Поля, обязательные для заполнения</div>
          <input type="submit" value="Отправить">
        </form>
      </div>

    </div>
  </div>
</div>
{% endblock %}




